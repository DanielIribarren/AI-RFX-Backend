# ESPECIFICACI√ìN T√âCNICA ACTUALIZADA ü§ñ
## SaaS de Generaci√≥n Inteligente de Presupuestos con Workflow Contextual

### üéØ CAMBIOS PRINCIPALES VS VERSI√ìN ORIGINAL
- ‚úÖ **Mantiene 85% de la arquitectura original**
- üîÑ **Agrega 4 tablas para contexto inteligente**
- üöÄ **Implementa workflow contextual con human-in-the-loop**
- üß† **Orquestador inteligente que entiende contexto**
- üìä **Configuraci√≥n din√°mica por tipo de proyecto**

---

## 1. MATRIZ COMPLETA DE ACCESO POR ROLES üîê

### 1.1 Tipos de Usuario (MANTIENE ORIGINAL)
- **Organization Owner (Owner)**: Control total de la organizaci√≥n
- **Admin**: Administraci√≥n del workspace
- **Manager**: Gesti√≥n de proyectos y equipo
- **User**: Usuario est√°ndar
- **Guest**: Acceso limitado espec√≠fico
- **Client**: Cliente externo (acceso p√∫blico)

### 1.2 Matriz de Acceso Actualizada con Nuevas Funcionalidades

| VISTA/FUNCIONALIDAD | Owner | Admin | Manager | User | Guest | Client |
|---------------------|-------|-------|---------|------|-------|--------|
| üè† Dashboard Principal | ‚úÖ Full | ‚úÖ Full | ‚úÖ Limited | ‚úÖ Personal | ‚ùå | ‚ùå |
| üìä Analytics Avanzados | ‚úÖ Full | ‚úÖ Full | ‚úÖ Team | ‚úÖ Personal | ‚ùå | ‚ùå |
| üìÅ Gesti√≥n Proyectos | ‚úÖ All | ‚úÖ All | ‚úÖ Team | ‚úÖ Own | üëÅ Assigned | ‚ùå |
| üìÑ Gesti√≥n Presupuestos | ‚úÖ All | ‚úÖ All | ‚úÖ Team | ‚úÖ Own | üëÅ Assigned | üëÅ Public |
| üé® Gesti√≥n Plantillas | ‚úÖ All | ‚úÖ Edit | ‚úÖ Use | ‚úÖ Use | ‚ùå | ‚ùå |
| **üß† Workflow Inteligente** | **‚úÖ Full** | **‚úÖ Full** | **‚úÖ Team** | **‚úÖ Own** | **üëÅ View** | **‚ùå** |
| **üìä An√°lisis Contextual** | **‚úÖ Full** | **‚úÖ Full** | **‚úÖ Team** | **‚úÖ Own** | **‚ùå** | **‚ùå** |
| **‚öôÔ∏è Config. Presupuestos** | **‚úÖ Full** | **‚úÖ Full** | **‚úÖ Team** | **‚úÖ Own** | **‚ùå** | **‚ùå** |
| üë• Gesti√≥n Usuarios | ‚úÖ Full | ‚úÖ Manage | üëÅ View | üëÅ View | ‚ùå | ‚ùå |
| üí≥ Facturaci√≥n/Planes | ‚úÖ Full | üëÅ View | ‚ùå | ‚ùå | ‚ùå | ‚ùå |
| üîó Webhooks/API | ‚úÖ Full | ‚úÖ Manage | ‚ùå | ‚ùå | ‚ùå | ‚ùå |
| üîç Audit Logs | ‚úÖ Full | ‚úÖ View | üëÅ Team | üëÅ Own | ‚ùå | ‚ùå |

---

## 2. ESQUEMA ACTUALIZADO DE BASE DE DATOS üóÑ

### 2.1 Arquitectura Multi-Tenant (MANTIENE ORIGINAL)
- Row Level Security (RLS) por organization_id
- √çndices particionados por organizaci√≥n
- Soft deletes para integridad referencial
- Audit trail autom√°tico

### 2.2 Tablas Principales (34 tablas total - 4 nuevas)

#### **TABLAS ORIGINALES MANTENIDAS (30 tablas)**
- ‚úÖ organizations (25 campos)
- ‚úÖ users (22 campos)  
- ‚úÖ organization_users (15 campos)
- ‚úÖ projects (48 campos)
- ‚úÖ project_items (35 campos)
- ‚úÖ project_documents (28 campos)
- ‚úÖ quotes (32 campos)
- ‚úÖ templates (25 campos)
- ‚úÖ usage_tracking (20 campos)
- ‚úÖ [... resto de tablas originales]

#### **NUEVAS TABLAS PARA WORKFLOW INTELIGENTE**

```sql
-- TABLA 1: Contexto de Proyectos (An√°lisis Orquestador)
CREATE TABLE project_context (
    -- Identificaci√≥n
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    project_id UUID NOT NULL REFERENCES projects(id),
    
    -- An√°lisis del Orquestador
    project_type_detected project_type_enum NOT NULL,
    complexity_score DECIMAL(5,4), -- 0.0000 a 1.0000
    budget_range_detected budget_range_enum,
    client_type_detected client_type_enum,
    
    -- Contexto Inferido por IA
    implicit_requirements JSONB DEFAULT '{}',
    market_context JSONB DEFAULT '{}',
    typical_costs_structure JSONB DEFAULT '{}',
    
    -- Estrategia de Extracci√≥n
    extraction_strategy JSONB DEFAULT '{}',
    expected_elements JSONB DEFAULT '{}',
    context_reasoning TEXT, -- Explicaci√≥n del an√°lisis
    
    -- Metadatos de An√°lisis
    analysis_confidence DECIMAL(5,4),
    analysis_method VARCHAR(100) DEFAULT 'openai_gpt4',
    analysis_timestamp TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    tokens_used INTEGER DEFAULT 0,
    
    -- Control
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    
    UNIQUE(project_id)
);

-- TABLA 2: Iteraciones de Extracci√≥n (Mejora Continua)
CREATE TABLE extraction_iterations (
    -- Identificaci√≥n
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    project_id UUID NOT NULL REFERENCES projects(id),
    iteration_number INTEGER NOT NULL,
    
    -- M√©todo y Configuraci√≥n
    extraction_method extraction_method_enum,
    extraction_prompt TEXT,
    context_used JSONB DEFAULT '{}',
    
    -- Resultados
    extracted_data JSONB NOT NULL,
    confidence_score DECIMAL(5,4),
    quality_issues JSONB DEFAULT '{}',
    
    -- Mejoras Aplicadas
    improvements_from_previous JSONB DEFAULT '{}',
    validation_results JSONB DEFAULT '{}',
    
    -- Performance
    processing_time_seconds DECIMAL(8,2),
    tokens_used INTEGER DEFAULT 0,
    cost_usd DECIMAL(10,4) DEFAULT 0,
    
    -- Control
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    
    UNIQUE(project_id, iteration_number)
);

-- TABLA 3: Configuraciones Flexibles de Presupuestos
CREATE TABLE quote_configurations (
    -- Identificaci√≥n
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    project_id UUID NOT NULL REFERENCES projects(id),
    
    -- Estructura de Costos Din√°mica
    pricing_model pricing_model_enum NOT NULL,
    cost_structure JSONB NOT NULL, -- {"per_person": true, "services_separate": true}
    calculation_rules JSONB DEFAULT '{}',
    
    -- M√°rgenes e Impuestos Flexibles
    profit_margin_percent DECIMAL(5,2) DEFAULT 25.00,
    tax_configuration JSONB DEFAULT '{}', -- {"iva": 16, "islr": 3, "municipal": 0}
    discount_rules JSONB DEFAULT '{}',
    
    -- Servicios Adicionales Contextuales
    additional_services JSONB DEFAULT '{}',
    service_calculations JSONB DEFAULT '{}',
    recommended_services JSONB DEFAULT '{}', -- Sugerencias de IA
    
    -- Personalizaci√≥n de Presentaci√≥n
    template_preferences JSONB DEFAULT '{}',
    style_configuration JSONB DEFAULT '{}',
    content_customization JSONB DEFAULT '{}',
    branding_options JSONB DEFAULT '{}',
    
    -- T√©rminos Inteligentes
    payment_terms TEXT,
    validity_days INTEGER DEFAULT 30,
    special_conditions JSONB DEFAULT '{}',
    auto_generated_terms BOOLEAN DEFAULT FALSE,
    
    -- Metadatos
    configuration_reason TEXT, -- Por qu√© se eligi√≥ esta config
    context_basis JSONB DEFAULT '{}',
    
    -- Control
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    
    UNIQUE(project_id)
);

-- TABLA 4: Estados del Workflow Inteligente
CREATE TABLE workflow_states (
    -- Identificaci√≥n
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    project_id UUID NOT NULL REFERENCES projects(id),
    
    -- Estado Actual del Workflow
    current_stage workflow_stage_enum NOT NULL DEFAULT 'document_uploaded',
    stage_progress DECIMAL(5,2) DEFAULT 0.00, -- % completitud etapa actual
    overall_progress DECIMAL(5,2) DEFAULT 0.00, -- % completitud total
    
    -- Historial y Transiciones
    stage_history JSONB DEFAULT '[]',
    stage_transitions_log JSONB DEFAULT '[]',
    stage_durations JSONB DEFAULT '{}', -- tiempo en cada etapa
    
    -- Intervenci√≥n Humana
    requires_human_intervention BOOLEAN DEFAULT FALSE,
    human_intervention_reason TEXT,
    human_intervention_stage workflow_stage_enum,
    human_intervention_completed BOOLEAN DEFAULT FALSE,
    human_intervention_notes TEXT,
    
    -- Calidad y Validaciones
    overall_confidence DECIMAL(5,4),
    quality_gates_passed INTEGER DEFAULT 0,
    quality_gates_total INTEGER DEFAULT 6,
    quality_issues JSONB DEFAULT '{}',
    
    -- Contexto del Workflow
    workflow_context JSONB DEFAULT '{}',
    ai_decisions_log JSONB DEFAULT '[]',
    user_overrides JSONB DEFAULT '{}',
    
    -- Metadata T√©cnica
    workflow_version VARCHAR(20) DEFAULT '1.0',
    estimated_completion_time INTERVAL,
    
    -- Control
    started_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    completed_at TIMESTAMP WITH TIME ZONE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    
    UNIQUE(project_id)
);
```

#### **NUEVOS ENUMS REQUERIDOS**

```sql
-- Modelos de precios flexibles
CREATE TYPE pricing_model_enum AS ENUM (
    'per_person_plus_services',    -- Catering: por persona + servicios
    'total_project_cost',          -- Consultor√≠a: costo total fijo
    'per_category_breakdown',      -- Eventos: por categor√≠as
    'hourly_rate',                 -- Servicios: por horas
    'per_square_meter',            -- Construcci√≥n: por m¬≤
    'value_based_pricing',         -- Consultor√≠a: basado en valor
    'per_unit_service'             -- General: por unidad de servicio
);

-- Rangos de presupuesto detectados
CREATE TYPE budget_range_enum AS ENUM (
    'low',           -- < $1,000
    'medium_low',    -- $1,000 - $5,000
    'medium',        -- $5,000 - $15,000
    'medium_high',   -- $15,000 - $50,000
    'high',          -- $50,000 - $100,000
    'premium'        -- > $100,000
);

-- Tipos de cliente detectados
CREATE TYPE client_type_enum AS ENUM (
    'individual',     -- Persona natural
    'small_business', -- Peque√±a empresa
    'corporate',      -- Empresa grande
    'government',     -- Sector p√∫blico
    'nonprofit'       -- Sin fines de lucro
);

-- Etapas del workflow inteligente
CREATE TYPE workflow_stage_enum AS ENUM (
    'document_uploaded',        -- 1. Documento cargado
    'context_analysis',         -- 2. An√°lisis contextual IA
    'intelligent_extraction',   -- 3. Extracci√≥n inteligente
    'extraction_validation',    -- 4. Validaci√≥n autom√°tica
    'human_review_required',    -- 5. Revisi√≥n humana requerida
    'configuration_setup',      -- 6. Configuraci√≥n de presupuesto
    'quote_generation',         -- 7. Generaci√≥n inteligente
    'quality_evaluation',       -- 8. Evaluaci√≥n de calidad
    'ready_for_delivery'        -- 9. Listo para entrega
);
```

#### **MODIFICACIONES A TABLAS EXISTENTES**

```sql
-- Expandir tabla quotes con metadata de generaci√≥n inteligente
ALTER TABLE quotes ADD COLUMN generation_context JSONB DEFAULT '{}';
ALTER TABLE quotes ADD COLUMN quality_score DECIMAL(5,4);
ALTER TABLE quotes ADD COLUMN optimization_applied JSONB DEFAULT '{}';
ALTER TABLE quotes ADD COLUMN template_customizations JSONB DEFAULT '{}';
ALTER TABLE quotes ADD COLUMN ai_generation_metadata JSONB DEFAULT '{}';

-- Expandir tabla projects con contexto b√°sico
ALTER TABLE projects ADD COLUMN context_analyzed BOOLEAN DEFAULT FALSE;
ALTER TABLE projects ADD COLUMN workflow_enabled BOOLEAN DEFAULT TRUE;
ALTER TABLE projects ADD COLUMN ai_confidence_overall DECIMAL(5,4);
```

---

## 3. ENDPOINTS API ACTUALIZADOS üîå

### 3.1 APIs Originales (MANTIENEN FUNCIONAMIENTO)
- ‚úÖ Todos los endpoints de la documentaci√≥n original
- ‚úÖ Autenticaci√≥n y organizaciones
- ‚úÖ Gesti√≥n de proyectos b√°sica
- ‚úÖ Sistema de plantillas
- ‚úÖ Generaci√≥n de PDFs

### 3.2 Nuevos Endpoints para Workflow Inteligente

#### **CONTEXTO Y AN√ÅLISIS INTELIGENTE**
```python
# An√°lisis contextual por orquestador IA
POST /api/projects/:id/analyze-context
"""
Trigger del orquestador para analizar contexto del proyecto
Input: project_id
Output: project_context con an√°lisis detallado
"""

GET /api/projects/:id/context
"""
Obtener contexto analizado del proyecto
Output: an√°lisis completo del orquestador
"""

PUT /api/projects/:id/context
"""
Actualizar/corregir contexto analizado
Input: correcciones del usuario
"""

POST /api/projects/:id/context/re-analyze
"""
Re-ejecutar an√°lisis contextual con nuevos par√°metros
"""
```

#### **WORKFLOW INTELIGENTE**
```python
# Estado y control del workflow
GET /api/projects/:id/workflow-status
"""
Estado actual del workflow inteligente
Output: etapa actual, progreso, intervenciones requeridas
"""

POST /api/projects/:id/workflow/advance-stage
"""
Avanzar workflow a siguiente etapa
Input: stage_validation_data
"""

POST /api/projects/:id/workflow/require-human-intervention
"""
Marcar que requiere intervenci√≥n humana
Input: reason, current_stage
"""

PUT /api/projects/:id/workflow/complete-human-intervention
"""
Completar intervenci√≥n humana y continuar workflow
Input: human_decisions, corrections
"""

GET /api/projects/:id/workflow/history
"""
Historial completo de etapas del workflow
"""
```

#### **EXTRACCI√ìN INTELIGENTE ITERATIVA**
```python
# Extracci√≥n con mejora continua
POST /api/projects/:id/extraction/iterate
"""
Ejecutar nueva iteraci√≥n de extracci√≥n inteligente
Input: improvements_to_apply, context_updates
"""

GET /api/projects/:id/extraction/iterations
"""
Todas las iteraciones de extracci√≥n realizadas
Output: historial con scores y mejoras
"""

PUT /api/projects/:id/extraction/validate
"""
Validar y confirmar extracci√≥n actual
Input: human_validation, corrections
"""

POST /api/projects/:id/extraction/optimize
"""
Optimizar extracci√≥n usando feedback previo
"""
```

#### **CONFIGURACI√ìN DIN√ÅMICA DE PRESUPUESTOS**
```python
# Configuraci√≥n flexible por contexto
GET /api/projects/:id/quote-configuration
"""
Configuraci√≥n actual de presupuesto
Output: pricing_model, structure, terms
"""

PUT /api/projects/:id/quote-configuration
"""
Actualizar configuraci√≥n de presupuesto
Input: nueva configuraci√≥n validada
"""

GET /api/projects/:id/configuration-schema
"""
Schema de configuraci√≥n din√°mico basado en contexto
Output: campos y opciones disponibles por tipo proyecto
"""

POST /api/projects/:id/configuration/recommend
"""
Recomendaciones IA para configuraci√≥n
Output: configuraci√≥n sugerida con reasoning
"""
```

#### **GENERACI√ìN INTELIGENTE Y EVALUACI√ìN**
```python
# Generaci√≥n contextual avanzada
POST /api/quotes/:id/generate-intelligent
"""
Generar presupuesto usando workflow completo
Input: finalized_configuration
Output: quote con metadata de generaci√≥n
"""

GET /api/quotes/:id/generation-metadata
"""
Metadata completa del proceso de generaci√≥n
Output: an√°lisis, decisiones IA, calidad
"""

POST /api/quotes/:id/optimize
"""
Optimizar presupuesto generado
Input: optimization_criteria
"""

POST /api/quotes/:id/evaluate-quality
"""
Evaluar calidad del presupuesto generado
Output: scores detallados y sugerencias
"""
```

#### **TEMPLATES CONTEXTUALES**
```python
# Selecci√≥n y personalizaci√≥n inteligente
GET /api/templates/contextual-selection/:project_id
"""
Selecci√≥n inteligente de template basada en contexto
Output: template recomendado con reasoning
"""

POST /api/templates/:id/customize-for-context
"""
Personalizar template espec√≠ficamente para contexto
Input: project_context, customization_preferences
"""

GET /api/templates/:id/preview-with-context/:project_id
"""
Preview de template aplicado al contexto espec√≠fico
"""
```

---

## 4. COMPONENTES FRONTEND ACTUALIZADOS üñ•

### 4.1 Vistas Originales Mantenidas
- ‚úÖ Dashboard principal
- ‚úÖ Gesti√≥n de proyectos
- ‚úÖ Sistema de plantillas
- ‚úÖ Configuraci√≥n de organizaci√≥n

### 4.2 Nuevas Vistas para Workflow Inteligente

#### **DASHBOARD DE WORKFLOW**
```ascii
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üß† AN√ÅLISIS INTELIGENTE - Boda Ana & Carlos                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                             ‚îÇ
‚îÇ üéØ CONTEXTO DETECTADO POR IA:                              ‚îÇ
‚îÇ Tipo: Catering para Boda | Invitados: ~150 | Budget: $$$  ‚îÇ
‚îÇ Complejidad: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñì‚ñì (82%) | Confianza: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñì‚ñì (87%)‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ üîÑ PROGRESO DEL WORKFLOW:                                   ‚îÇ
‚îÇ ‚úÖ An√°lisis Contextual    ‚úÖ Extracci√≥n Inteligente        ‚îÇ
‚îÇ ‚úÖ Validaci√≥n Autom√°tica  üîÑ Revisi√≥n Humana (ACTUAL)      ‚îÇ
‚îÇ ‚è≥ Config. Presupuesto   ‚è≥ Generaci√≥n Final               ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ ‚ö†Ô∏è REQUIERE ATENCI√ìN:                                       ‚îÇ
‚îÇ ‚Ä¢ Confirmar servicios adicionales sugeridos por IA         ‚îÇ
‚îÇ ‚Ä¢ Validar estructura de costos por persona vs total        ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ [üîÑ Continuar Workflow] [‚úèÔ∏è Intervenir] [üëÅÔ∏è Ver Detalles] ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### **INTERFAZ DE HUMAN-IN-THE-LOOP**
```ascii
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ü§ù REVISI√ìN HUMANA REQUERIDA                               ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                             ‚îÇ
‚îÇ üéØ LA IA NECESITA TU CONFIRMACI√ìN:                          ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ EXTRACCI√ìN DETECTADA:                                       ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇ ‚úÖ Cliente: Ana Garc√≠a & Carlos Rodr√≠guez               ‚îÇ ‚îÇ
‚îÇ ‚îÇ ‚úÖ Evento: Boda - 15 Marzo 2025                         ‚îÇ ‚îÇ
‚îÇ ‚îÇ ‚úÖ Invitados: 150 personas                              ‚îÇ ‚îÇ
‚îÇ ‚îÇ ‚ö†Ô∏è Men√∫: Salm√≥n + Lomito + Acompa√±antes                 ‚îÇ ‚îÇ
‚îÇ ‚îÇ    [La IA detect√≥ alta calidad pero precio no claro]    ‚îÇ ‚îÇ
‚îÇ ‚îÇ ü§î Servicios: Personal + Coordinaci√≥n                   ‚îÇ ‚îÇ
‚îÇ ‚îÇ    [IA sugiere: "T√≠pico para bodas de este nivel"]     ‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ CONFIGURACI√ìN RECOMENDADA POR IA:                          ‚îÇ
‚îÇ ‚óâ Costo por persona + servicios adicionales                ‚îÇ
‚îÇ ‚óã Costo total del proyecto                                  ‚îÇ
‚îÇ Raz√≥n: "Est√°ndar para catering de bodas premium"           ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ [‚úÖ Confirmar y Continuar] [‚úèÔ∏è Editar Antes] [üîÑ Re-analizar]‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### **CONFIGURACI√ìN DIN√ÅMICA**
```ascii
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚öôÔ∏è CONFIGURACI√ìN INTELIGENTE DE PRESUPUESTO                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                             ‚îÇ
‚îÇ üí° RECOMENDACIONES DE IA PARA ESTE CONTEXTO:               ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ ESTRUCTURA DE COSTOS: [Basado en an√°lisis de 247 bodas]    ‚îÇ
‚îÇ ‚óâ Por persona ($53.51) + servicios extras                  ‚îÇ
‚îÇ   ‚úì Est√°ndar para bodas premium                            ‚îÇ
‚îÇ   ‚úì F√°cil comparaci√≥n para cliente                         ‚îÇ
‚îÇ ‚óã Costo total del proyecto ($8,025.75)                     ‚îÇ
‚îÇ   ‚úó Menos transparente para eventos                        ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ SERVICIOS RECOMENDADOS: [IA detect√≥ necesidades t√≠picas]   ‚îÇ
‚îÇ ‚úÖ Personal servicio (1 por cada 19 invitados) - $960      ‚îÇ
‚îÇ ‚úÖ Coordinaci√≥n evento (est√°ndar bodas) - $300             ‚îÇ
‚îÇ ü§î Transporte (25km detectado) - $150                      ‚îÇ
‚îÇ ü§î Vajilla premium (impl√≠cito en documento) - $450         ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ T√âRMINOS INTELIGENTES:                                      ‚îÇ
‚îÇ ‚úÖ 30% adelanto (t√≠pico bodas Venezuela)                   ‚îÇ
‚îÇ ‚úÖ IVA 16% incluido                                         ‚îÇ
‚îÇ ‚úÖ Validez 30 d√≠as (eventos con fecha fija)                ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ [üé® Personalizar] [üöÄ Usar Recomendado] [üíæ Guardar]       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 5. PLAN DE IMPLEMENTACI√ìN PROGRESIVA üöÄ

### **FASE 1: MVP CON CONTEXTO B√ÅSICO (Semanas 1-4)**

**Implementaci√≥n m√≠nima viable del workflow:**
- Orquestador b√°sico con 3 tipos: catering, consultor√≠a, general
- Extracci√≥n inteligente con 1 iteraci√≥n
- Human-in-the-loop esencial
- Configuraci√≥n b√°sica din√°mica
- 2 templates adaptativos

```bash
# Claude Code para Fase 1
claude-code "Create FastAPI project with PostgreSQL including 4 new context tables"
claude-code "Implement basic AI orchestrator for project context analysis"
claude-code "Build human-in-the-loop interface for validation and configuration"
claude-code "Create flexible quote configuration system with 3 pricing models"
```

### **FASE 2: WORKFLOW COMPLETO (Semanas 5-8)**

**Workflow inteligente completo:**
- Orquestador avanzado con 6+ tipos de proyecto
- Extracci√≥n iterativa con mejora continua
- Configuraci√≥n completamente din√°mica
- Evaluaci√≥n de calidad autom√°tica
- Templates contextuales avanzados

```bash
# Claude Code para Fase 2
claude-code "Expand AI orchestrator with advanced context analysis for 6 project types"
claude-code "Implement iterative extraction system with confidence scoring"
claude-code "Create quality evaluation system with automated optimization"
claude-code "Build contextual template engine with intelligent customization"
```

### **FASE 3: OPTIMIZACI√ìN IA (Semanas 9-12)**

**Optimizaciones avanzadas:**
- Fine-tuning de prompts por contexto
- Aprendizaje de decisiones humanas
- Optimizaci√≥n de costos de IA
- Analytics de performance del workflow

---

## 6. M√âTRICAS DE √âXITO ACTUALIZADAS üìä

### **M√©tricas T√©cnicas del Workflow:**
- ‚úÖ Precisi√≥n contexto: >85% en detecci√≥n tipo proyecto
- ‚úÖ Reducci√≥n intervenci√≥n humana: <30% de casos
- ‚úÖ Tiempo workflow completo: <10 minutos promedio
- ‚úÖ Score calidad presupuestos: >90% casos

### **M√©tricas de Negocio:**
- ‚úÖ Time-to-quote: <15 minutos vs 2+ horas manual
- ‚úÖ Tasa conversi√≥n: +25% vs presupuestos manuales
- ‚úÖ Satisfacci√≥n usuario: NPS >60
- ‚úÖ Retenci√≥n: Churn <5% mensual

### **M√©tricas de IA:**
- ‚úÖ Costo por presupuesto: <$0.25 en prompts OpenAI
- ‚úÖ Tokens promedio: <8,000 por workflow completo
- ‚úÖ Precisi√≥n extracci√≥n: >90% campos cr√≠ticos
- ‚úÖ Confianza promedio: >85% en decisiones IA

---

## üéØ RESUMEN EJECUTIVO

### **‚úÖ LO QUE MANTIENE (85% original):**
- Toda la arquitectura multi-tenant robusta
- Sistema de roles y permisos granular
- 30 tablas originales intactas
- APIs b√°sicas funcionando
- Frontend base con navegaci√≥n

### **üöÄ LO QUE AGREGA (15% nuevas funcionalidades):**
- **4 tablas nuevas** para contexto e inteligencia
- **Workflow contextual** que entiende como humano
- **Human-in-the-loop** inteligente
- **Configuraci√≥n din√°mica** por tipo de proyecto
- **15 endpoints adicionales** para workflow

### **üí° BENEFICIO DIFERENCIAL:**
- **3x m√°s r√°pido** que competencia en generaci√≥n
- **Presupuestos contextuales** vs extractores de texto
- **Configuraci√≥n inteligente** vs templates r√≠gidos
- **Workflow guiado** vs proceso manual completo

Este dise√±o mantiene la **solidez t√©cnica original** mientras agrega la **inteligencia contextual** que diferencia el producto en el mercado.

**¬øApruebas proceder con esta especificaci√≥n actualizada?** üöÄ